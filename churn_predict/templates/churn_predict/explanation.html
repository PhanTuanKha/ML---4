{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Analysis & Evaluation</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-blue: #4A69FF;
            --dark-text: #1A202C;
            --light-text: #5A6372;
            --background-light: #F7FAFC;
            --white: #FFFFFF;
            --border-color: #E2E8F0;
            --border-light-2: #EFF2F7;
            --error-red: #e53e3e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Be Vietnam Pro', sans-serif; line-height: 1.6; color: var(--dark-text); background-color: var(--background-light); }
        .container { max-width: 1280px; margin: 0 auto; padding: 0 20px; }
        .main-header { position: sticky; top: 0; left: 0; width: 100%; background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); z-index: 1000; border-bottom: 1px solid var(--border-color); }
        .main-nav { display: flex; justify-content: space-between; align-items: center; height: 80px; }
        .logo { display: flex; align-items: center; text-decoration: none; }
        .logo svg { width: 40px; height: 40px; color: var(--primary-blue); }
        .user-menu { display: flex; align-items: center; gap: 20px; }
        .btn-logout { cursor: pointer; background: none; border: 1px solid var(--error-red); color: var(--error-red); font-family: 'Be Vietnam Pro', sans-serif; text-decoration: none; padding: 8px 20px; border-radius: 8px; font-weight: 500; font-size: 15px; transition: all 0.3s ease; }
        .btn-logout:hover { background-color: var(--error-red); color: var(--white); }
        .analyze-main { padding-top: 40px; padding-bottom: 80px; }
        .page-header { margin-bottom: 40px; }
        .page-header h2 { font-size: 32px; margin-bottom: 8px; }
        .page-header p { font-size: 18px; color: var(--light-text); }
        .btn-back { display: inline-flex; align-items: center; gap: 8px; text-decoration: none; color: var(--light-text); font-weight: 600; padding: 8px 16px; border-radius: 8px; background-color: var(--white); border: 1px solid var(--border-color); margin-bottom: 25px; transition: all 0.2s ease; }
        .btn-back:hover { background-color: var(--background-light); color: var(--primary-blue); border-color: var(--primary-blue); }
        
        /* SỬA ĐỔI: Bỏ grid 2 cột, chỉ dùng 1 cột */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr; /* Chỉ 1 cột */
            gap: 30px;
            align-items: flex-start;
        }

        .card { background-color: var(--white); border-radius: 12px; border: 1px solid var(--border-color); padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .card h3 { font-size: 20px; font-weight: 700; color: var(--dark-text); margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .placeholder-text { color: var(--light-text); text-align: center; padding: 40px 20px; font-style: italic;}
        .visualization-card { min-height: 450px; }
        
        /* CSS cho iframe và ảnh */
        .explanation-content { width: 100%; }
        .explanation-content img { width: 100%; height: auto; border-radius: 8px; max-width: 800px; display: block; margin: 0 auto; }
        .explanation-content iframe { width: 100%; height: 500px; border: none; border-radius: 8px; }
        .explanation-description { font-size: 14px; color: var(--light-text); margin-bottom: 20px; line-height: 1.7; }

        /* CSS cho metrics (lấy từ predict.html) */
        .metrics-list { list-style: none; padding: 0; }
        .metrics-list li { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-light-2); font-size: 15px; }
        .metrics-list li:last-child { border-bottom: none; }
        .metrics-list .metric-label { font-weight: 600; color: var(--light-text); }
        .metrics-list .metric-value { font-weight: 700; font-size: 18px; color: var(--primary-blue); }
    </style>
</head>
<body>

    <header class="main-header">
        <nav class="container main-nav">
            <a href="{% url 'core:welcome' %}" class="logo">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"></svg>
            </a>
            <div class="user-menu">
                <a href="{% url 'core:logout' %}" class="btn-logout">Log out</a>
            </div>
        </nav>
    </header>

    <main class="analyze-main">
        <div class="container">
            <div class="page-header">
                <a href="{% url 'core:welcome' %}" class="btn-back">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Home</span>
                </a>
                <h2>Explanation (Model: Gradient Boosting)</h2>
                <p>Explanation and evaluation metrics for the best-performing model.</p>
            </div>

            <div class="content-grid">
                
                <div>
                    <div class="card" style="margin-bottom: 30px;">
                        <h3>Evaluation Metrics (Gradient Boosting)</h3>
                        {% if metrics %}
                            <ul class="metrics-list">
                                {% for key, value in metrics.items %}
                                    <li>
                                        <span class="metric-label">{{ key }}</span>
                                        <span class="metric-value">{{ value }}</span>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="placeholder-text">Không thể tải Metrics.</p>
                        {% endif %}
                    </div>
                
                    <div class="card visualization-card" style="margin-bottom: 30px;">
                        <h3>{{ explanation_title }} - SHAP</h3>
                        
                        <p class="explanation-description">
                            <strong>SHAP (SHapley Additive exPlanations)</strong> summarizes which features have the greatest impact on the model's predictions across the entire dataset.
                            <br>• Customers with month-to-month contracts have a significantly higher likelihood of churn.
                            <br>• The newer the customer, the more likely they are to churn. Conversely, long-term customers tend to be more loyal.
                        </p>
                        
                        <div class="explanation-content">
                            {% if shap_image_url %}
                                <img src="{{ shap_image_url }}" alt="SHAP Summary Plot">
                            {% else %}
                                <p class="placeholder-text">Không tìm thấy ảnh SHAP.</p>
                            {% endif %}
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </main>
    
    </body>
</html>